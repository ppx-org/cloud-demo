<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title></title>

<link th:replace="common/fragment/common::common"/>
<link th:replace="common/fragment/common::validation"/>

<script type="text/javascript" th:inline="javascript">
$(function() {
	refreshPageData([[${listJson}]]);
});

function queryPage(pageNumber) {
	showLoading();
	$("#pageNumber").val(pageNumber);
	$.post([[@{/product/listJson}]], $("#queryForm").serialize(), function(r) {
		refreshPageData(r);
		hideLoading();
	});
}

function add() {
	exp();
}

function exp() {
	
	
	var tr = "";
	for (var i = 0; i < 1000; i++) {
		tr = tr + '<tr><td>' + i + '</td><td>保利（广州）物业发展有限公司</td><td>安防部</td><td>安防部</td><td>一级基层员工</td><td>一级安防员</td><tr>';
	}
	tableToExcel(tr);
}

var tableToExcel = (function() {
	var uri = 'data:application/vnd.ms-excel;base64,';
var head = '<xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>导出文件</x:Name>\
			<x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>\
			</x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml>';	
	var template = '<html xmlns:x="urn:schemas-microsoft-com:office:excel"><head>' + head + '</head><body><table border=1><tbody>{table}</tbody></table></body></html>';  
	var	base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) };  
var format = function(s, c) {return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) }  
return function(tableHtml) {
   var ctx = {table:tableHtml}
   //window.location.href = uri + base64(format(template, ctx));
   //alert(uri);
   
   // data:application/vnd.ms-excel;base64,
   

   
   alert(base64(format(template, ctx)).length);
   window.location.href = uri + base64(format(template, ctx));
   //$("#gogo").attr("href", uri + base64(format(template, ctx)));
}
})()

function edit() {
	
}

try {
    var isFileSaverSupported = !!new Blob;
    alert("isFileSaverSupported:" + isFileSaverSupported);
} catch (e) {}

</script>
</head>

<body>
<div th:replace="common/fragment/common::pageList('PROD')">
	<div th:fragment="queryFragment">
		<button type="button" class="btn btn-success btn-sm" onclick="add()">新增</button>
		
		<img id="gogo" href="#">gogo</a>
		<input type="text" class="form-control input-sm" name="testName" placeholder="请输入NAME" style="width:200px;">
		<button type="button" class="btn btn-default btn-sm" onclick="queryPage(1);"><span class="glyphicon glyphicon-search"></span>搜索</button>
	</div>
	<table th:fragment="listFragment">
	<tr>
		<th>ID</th>
		<th>TIME</th>
		<th>操作</th>
	</tr>
	<script id="pageTemplate" type="text/html">
	{{each arrayList as v i}}
	<tr>
		<td class="w-id">{{v.prodId}}</td>
		<td class="w-title-s">{{v.prodTitle}}</td>
		<td class="w-action">
			<a href="#" onclick="edit('{{v.prodId}}')" class="glyphicon glyphicon-edit" title="修改"></a>
		</td>
	</tr>
	{{/each}}
	</script>
	</table>
</div>



</body>
</html>

